package minimize_deviation_in_array_1675;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import java.util.PriorityQueue;

/**
 * Created by Zhiyong Pan on 2021-01-30.
 */
public class Solution {
    static class Num {
        int val;
        int orig;

        Num(int v, int o) {
            val = v;
            orig = o;
        }
    }

    public int minimumDeviation(int[] nums) {
        PriorityQueue<Num> minHeap = new PriorityQueue<>((a, b) -> a.val - b.val);

        // The lower & upper bounds of the numbers.
        int L = 0, U = 0;

        // The minimal odd value.
        int minOddVal = 1;
        for (int i = 0; i < nums.length; ++i) {
            if (nums[i] % 2 == 1 && (minOddVal == 0 || nums[i] < minOddVal))
                minOddVal = nums[i];
        }

        // Make all numbers be their minimum possible values.
        // Since odd numbers can not be decreased, this process affects even numbers only.
        // By the way, attain U in this loop.
        for (int i = 0; i < nums.length; ++i) {
            int v = nums[i];
            while (v % 2 == 0 && v / 2 >= minOddVal) {
                v /= 2;
            }
            minHeap.add(new Num(v, nums[i]));

            if (U == 0 || U < v)
                U = v;
        }

        // Notice that minOddVal is not necessary the minimum of all, there may be smaller evens.
        L = minHeap.peek().val;

        // Initial answer, will be updated.
        int ans = U - L;

        // x2 the L as long as we can.
        // Notice that at a certain point, we don't know whether x2 will get us closer to the minimized deviation,
        // but we still do it because we known we will encounter it sooner or later during this numeration.
        while (ans > 0) {
            // Get the current max & min values.
            Num aObj = minHeap.poll();
            int a = aObj.val;

            if (a % 2 == 0 && a >= aObj.orig)
                break;

            int b = minHeap.peek().val;

            // a *= 2
            if (2 * a <= aObj.orig && aObj.orig <= U)
                a = aObj.orig;
            else
                a *= 2;

            U = Math.max(a, U);
            L = Math.min(a, b);
            aObj.val = a;
            minHeap.add(aObj);
            ans = Math.min(ans, U - L);
        }

        return ans;
    }

    @Test
    void example1() {
        Assertions.assertEquals(1, minimumDeviation(new int[]{2, 8, 6, 1, 6}));
        Assertions.assertEquals(2, minimumDeviation(new int[]{10, 4, 3}));
        Assertions.assertEquals(1, minimumDeviation(new int[]{1, 2, 3, 4}));
        Assertions.assertEquals(3, minimumDeviation(new int[]{4, 1, 5, 20, 3}));
        Assertions.assertEquals(3, minimumDeviation(new int[]{2, 10, 8}));
        Assertions.assertEquals(0, minimumDeviation(new int[]{1, 2}));
        Assertions.assertEquals(0, minimumDeviation(new int[]{1, 1}));
        Assertions.assertEquals(0, minimumDeviation(new int[]{2, 2}));
        Assertions.assertEquals(23, minimumDeviation(new int[]{1, 100}));
        Assertions.assertEquals(23, minimumDeviation(new int[]{1, 80, 100}));
        Assertions.assertEquals(43, minimumDeviation(new int[]{1, 90, 100}));
        Assertions.assertEquals(315, minimumDeviation(new int[]{399, 908, 648, 357, 693, 502, 331, 649, 596, 698}));
        Assertions.assertEquals(98683701, minimumDeviation(new int[]{
                139502287, 127662367, 182874278, 195316256, 158258043, 128106398, 165570519, 161630895, 197087073, 177018029, 142241150, 189463437, 114131106, 180827841, 140563651, 140631914, 127439843, 117651449, 108277946, 148148621, 198133057, 173477124, 180664549, 119749615, 192791912, 171503536, 146780066, 146619923, 180198468, 132326257, 129079222, 142091904, 115753487, 178875891, 171861205, 165113533, 105888611, 148201456, 114722931, 111227228, 139403775, 192371264, 112237013, 173895760, 188650252, 109366482, 174511822, 108640913, 191279346, 127663274, 180400034, 179515445, 109423556, 191502543, 108986309, 163189619, 168756945, 177284541, 114642866, 136718954, 146122849, 186435019, 108451832, 162317887, 137725843, 138164718, 170588551, 159632836, 139405555, 105243015, 187461591, 156505003, 163176045, 107100346, 124266013, 198186644, 160653221, 157330716, 188843428, 130131460, 136191103, 120065496, 143836292, 194312999, 108470642, 166356073, 192320235, 101600108, 170925551, 197600861, 149364536, 158492279, 166594704, 141871659, 197119385, 187931161, 141314732, 124536617, 102505057, 142054441, 142144983, 139492998, 114061225, 172915905, 186326112, 101258267, 176016355, 117310304, 134565576, 175774728, 115461652, 173657901, 150872767, 127024993, 164739980, 199913646, 140093586, 140579776, 115345543, 115718199, 111611931, 189004451, 117768984, 160145942, 103569746, 150336410, 166224862, 129187299, 147130259, 158224131, 167485119, 115017904, 104014213, 149432483, 102127258, 199320902, 193569603, 157552714, 113431868, 165365010, 162721361, 169993800, 130956004, 123456024, 157811076, 167771287, 103114996, 183508477, 171322947, 103516387, 118407455, 111055030, 161774593, 106983428, 187953441, 186774576, 106113788, 124972645, 140254982, 102498490, 186169756, 112171085, 181140323, 127509228, 139727086, 170141845, 102263907, 125782453, 198344152, 132630801, 135853494, 171044990, 143562844, 128452102, 166392273, 154488151, 125841090, 155342972, 118665099, 183467485, 105245785, 173770396, 182229265, 102072773, 137044502, 148387216, 139608067, 141567001, 150810789, 114476348, 163267954, 164259991, 165425337, 152560087, 193558089, 180008386, 154925409, 153149280, 144881521, 161927809, 103701602, 124355592, 199332316, 164457368, 184521526, 176380601, 132487910, 136872491, 124394249, 178518694, 129959078, 168807287, 165621480, 142432287, 186679088, 142687756, 149852668, 137400257, 130710611, 177159816, 143972099, 179566227, 139405172, 125527818, 138882615, 192825874, 115915326, 176351775, 149859250, 196724440, 188496780, 102484169, 138858670, 135845950, 187121403, 165486776, 143305183, 167154441, 171152787, 178418731, 155915678, 138488715, 176113588, 133032247, 135266151, 150545120, 193146386, 100587965, 105628049, 127805067, 100092626, 119758139, 174858873, 145984705, 192910027, 181173340, 138042671, 122308978, 160770301, 130394674, 166492711, 161910843, 119184450, 109853721, 170848534, 121342141, 100838796, 198131866, 156427959, 176020777, 184930698, 117558856, 113507815, 153587163, 123588933, 120472984, 198163856, 107901250, 182464664, 128964739, 138765154, 197553755, 190480953, 169538709, 105129765, 143353678, 199607036, 144583353, 199403460, 195738467, 124778611, 186233414, 168628878, 101977678, 160897452, 195801072, 186941874, 177230274, 179583881, 133909934, 175430770, 158050009, 141158921, 159321118, 192978346, 153948939, 147725900, 128959020, 152949311, 173602535, 195643978, 120013972, 142084051, 136108423, 121580658, 145565683, 156257215, 199766954, 187813699, 171156531, 162645972, 100216855, 139697220, 182202999, 147699018, 110023818, 176058211, 185321487, 176811279, 100190707, 135798617, 116045000, 140572589, 172900728, 116145251, 140651548, 165834418, 116121994, 186652919, 103162165, 164716217, 117471904, 155970321, 113282879, 105493962, 103599601, 188489301, 155340595, 136108503, 127347508, 194267446
        }));
        Assertions.assertEquals(99366288, minimumDeviation(new int[]{
                124283766,153937146,180763446,127353467,176850460,130892224,151730369,184733383,176240461,137853183,178320449,120883790,137879376,107092550,113347311,182344020,117776013,132341669,124034377,109247764,165467919,143749960,188719816,155695063,182093470,192287827,197365988,105702339,172277958,175288199,177611634,135590146,184817402,158899992,190144665,195266116,114642406,156598497,181981614,190610224,190360140,193603730,110452070,164232277,150362358,106952692,185054665,105549227,128022838,179225922,168608419,141927449,120513310,162652755,121287416,139954811,125980465,126408394,163362420,169028428,138203466,189623150,125754852,167622254,121460330,134657851,191653561,127352623,118301065,176932453,107569822,160289887,156265050,168153893,122647284,147049597,102838709,163672020,127247438,137494391,167914212,179407102,128356813,130310627,104597621,147038565,197338907,180638447,101920653,103189507,198727822,126268130,151712625,139499987,134767665,169341684,135487709,175935775,142434369,194475658,145745689,136842652,180009191,180765560,136145008,140655465,140728509,154074741,181104688,109496515,129674711,191676766,163830629,110543797,190892426,161708839,124808929,167950747,113263180,172291866,189788680,173944436,198800973,117684038,109597969,101542471,153067998,126357179,134300411,187639845,121741963,105422911,172504369,144735953,113152833,118993300,170365666,160914418,162115191,193771038,188539740,184254718,104889223,108684893,104315759,105442551,186961577,196479220,134351965,167957038,161144165,121365493,164396359,111819702,125955416,145132725,149415369,164646811,186088683,161007459,147848946,127525682,103371436,176467929,129333829,168526073,146635246,165511133,126775047,162735851,110620065,168643922,144958120,158717211,142790142,156761120,195163902,183753331,178077769,190687441,124467211,178062842,165718495,127087114,136394793,173887472,170211466,104866757,120837615,122504221,147730993,121122927,167265522,175410604,172383807,192124311,131388873,150797043,117529497,166907752,171434831,166472777,165374643,198058993,156922214,114532810,120841031,104549665,121309424,136012202,107975778,103947876,137679561,186886222,136670690,122547215,140642861,122201295,113783508,166950357,181234851,126552263,194709689,164025822,172705543,155050979,166501002,160748893,181435644,167799323,106189705,107965209,182069437,156732401,145983828,172086544,181322389,146842426,170952579,169389387,174012018,122933324,150731766,148583321,197117794,110157584,195461334,198090380,116158281,120604196,141638819,170978912,159606308,175109328,162842248,127658686,105585241,112604822,184731557,186438170,172431176,177778378,123302104,110695990,114125459,122091080,177689432,145167591,188780460,143077084,182564911,153176784,131362502,194848964,176671008,104491976,143594108,155405248,198859842,188670261,154400585,126820856,146081548,127220315,102757157,139848609,195731065,156324195,152253814,133144580,152600283,130970892,161915743,148514498,144931329,148099301,195651848,134280901,111297248,121134329,185636734,185593196,198117892,163646114,106724232,154236015,135854348,192917885,188357388,135899022,119087726,181029752,130899970,170665408,127611769,193917232,186202315,144702218,190316437,100528020,151001851,158176583,167375553,190931893,164254121,132432691,134298939,193539022,175370430,173817858,178447923,113096700,180780038,181097852,163622324,113159236,181091550,159664341,135690505,169867360,186165071,124434419,150504323,172556654,178865450,122013900,101715473,157466545,121649390,117106616,194930207,177108297,160645484,128515774,194942750,128726765,171676647,132388079,152966300,111960275,147154948,194789297,140920979,182923327,189986318,109037899,179944882,125564391,174632905,115894665,149791742,197673209,127627437,162346580,133793807,104174233,132691847,153590451,157036531,143748799,169893988,194854294,121772432,140549971,121831330,188893324,109925852,198447062,123446158,172756376,137195723,124265349,149317463,106444282,132610884,118902225,106224043,199528784,143190114,142732326,184650839,125596339,186560153,157990789,139807110,156539902,161184483,138290209,123688748,189102450,122059014,169587584,100547183,149918890,146328432,153824473,195857397,112733454,116394353,140138388,119154495,152865785,105429699,182861941,197716056,155221148,102603098,156563618,156779903,104985345,126409074,138482095,119190322,193993819,128362584,100017119,116740467,186672985,174821753,142777586,198341917,107395328,100698727,170524909,126122135,177374615,140871061,153141416,135009718,121562576,110377841,156431283,193001440,173663985,157686706,175467333,146718177,101381157,130080034,181879840,175220574,198729292,187934465,114719764,162059001,134219676,139143445,107216083,155111706,158350227,105948718,148339271,132170407,194307518,125788475,113237685,170007455,100302762,179256529,118694198,119169421,163538113,112869948,137497800,170382776,154125897,110221912,117238825,156806930,176973985,173137814,133452165,145351924,118665013,148663169,105970823,126614205,106226031,144597860,192785818,156793611,143933705,175762392,184627567,111119873,150075447,186703201,138343881,190765385,106155375,110483940,124968305,119722129,144665077,165457069,172274733,136268448,186043765,193070268,125223843,101565237,173586328,107841528,179453158,188042181,161430131,187974204,191747919,138425871,120030528,128411729,122290603,151414002,121639474,172161080,138403006,127447223,128430977,137757487,109968958,119911982,103023589,188427965,123664976,105257692,188615755,169999893,182524058,155599873,130201737,157453014,181489451,194687734,169838347,184852859,139760739,186981931,110170430,163680325,168596113,119071596,153343374,113580759,107745191,175875040,196808710,126278451,140896623,117120519,170349980,138392844,184596319,130488548,126512422,149492384,135131235,188093864,171379590,148928598,140015347,144154269,132461259,170649054,102457004,143467102,146730596,133830540,110410112,186612889,171000814,180787198,102653868,177185710,172322686,147172889,110807854,194971454,121334731,140008232,137729607,141196980,177756707,116802385,130582955,140738457,184298683,158680980,132102851,115843098,147540448,187639663,119761011,186060358,194271086,188403029,108375507,187273010,108889880,171537818,134183070,181428377,184598206,129732828,146654812,135838201,115993202,135782602,173149562,109369396,112444009,170733133,139444992,126603454,147096120,134303163,152933169,147233970,158972042,121844326,118308106,141771759,178292872,179258655,188250243,143635823,120335210,127357682,152832016,173106282,178362254,148098865,165294694,196169358,133112070,143933711,147253957,100950126,132909046,175037570,113311259,150318241,193851766,191490549,175484021,167558733,114849864,152927921,138487864,124608440,134487345,115004078,119170023,101764752,106105598,154164074,179725551,108715079,152704802,129280866,111221551,171251506,178602772,134401721,177436981,183700804,195383998,121693449,179656390,143852793,137241585,135307183,126362881,172781396,187681752,142444399,100111691,173047206,103536609,164767813,182852223,164010191,161513263,119735447,149150767,154473587,145692735,131913417,125263547,184977309,133266891,197695315,159746353,142047946,109811199,156858899,137718418,126029391,111630063,127107232,173545022,177153312,123973911,118156250,147896622,180338652,189011455,107192352,149070936,180091543,156023466,132344211,195795418,171894038,197979871,140923329,165541340,163504971,193692059,153014331,182921769,152033217,159279544,150938220,181982566,193570960,128340340,180570857,186941682,139519141,162221372,156681641,168113842,124869302,110319033,134690830,132637796,120925274,148428702,185581638,134170706,173895205,133792258,142119535,153740805,181214688,169953553,195649634,126592834,192305265,109728909,188727306,179829659,110267679,103540161,128308785,108410951,113326059,163090111,116955940,184368351,147026984,176368167,144868853,111966382,161299858,166185865,169363180,111234726,173739204,151686331,185410554,124178342,172914796,128246494,116073941,133118607,157068165,197780078,139034798,128434494,191254179,118477023,168773265,100894936,114658961,165296595,120909254,167255519,112593432,172568336,155010412,129378085,170094773,183326965,127784308,125281618,128995953,128779110,189740642,186070930,186832429,101495934,116623029,101799784,136687876,192309428,164037132,124562134,149579909,127929249,122119583,145258509,196620831,126885693,191303486,161477373,164794088,114248284,186491954,182776447,148598176,127602036,145976141,125913969,109078781,182190587,171000983,124229492,185442858,164262325,167225851,188617296,170253191,140772513,159019488,150701944,162175090,158016903,194829201,128383462,124905899,143218085,182915433,158256900,166796119,171164860,189386042,191968324,100285756,136643390,151695489,189897992,187250063,143725812,177618424,120550362,141661199,119902546,146347474,185864757,124734006,139574679,197925587,118513644,144163772,172462008,183518286,115042357,104011911,175957247,112178274,162405630,114013599,148159511,122542017,179024699,104474102,153454416,112140807,152973856,105309020,116468316,112357602,113774094,191607166,181088884,141564758,184937157,189348270,112805389,182064521,155938052,143409076,167154149,113265649,104320200,131311038,124083033,159070144,196638766,165431328,191500312,156879210,120731553,113748069,135171970,164061572,198098268,178522176,175670726,151144973,146901318,123245372,185342087,192937720,147105064,197917499,114754678,162296050,192684813,166012986,107100870,117922402,135740820,159848050,181250282,187488644,161457299,175064548,179258762,180109256,140065174,155937795,119157554,149801421,140521629,190335430,128430304,105245019,161854221,196103244,171374747,105470003,161645496,144582481,144711876,185425515,190311643,161990753,103102898,119145810,134548271,126968440,154327154,160196410,117243255,122088593,140371917,143622203,180053304,128425273,124140862,181407270,177018002,143656752,181183366,182567619,180902796,175090125,170563548,196590309,187596308,174575108,156215127,140513903,114995358,100403996,159896837,192724780,189763196,163604578,183488895,184988467,129950682,170230874,118286200,174172786,178917138,157084610,134020559,150102832,188881034,114881700,133214161,128534483,174161743,180818803,177067378,179428649,139846362,189061402,136822272,158632689,118693673,176529972,121456683,153947610,113453150,140914583,176428891,118700800,191814092,141377874,184994588,139156371,168952275,111716216,133376006,176743569,162894494,187293076,139694101,111573526,106723005,195005845,163898931,165227754,186132142,178203712,117194372,102979005,189477176,148957086,156683898,139202971,127974463,107601366,129548950,188427062,123019568,119116174,119857752,180520506,187157684,189524457,146968295,151858834,189317839,100479715,199637832,172592859,199348104,126172983,119179567,103646625,187916208,152248864,153377681,189740639,154698838,183226791,169169207,140847750,137463513,175957078,181649472,119127484,127955931,134545591,174745344,105085830,150004990,132909520,107807781,105069746,196981338,156094212,116700661,183722418,122438187,127223078,134030855,119696994,182961081,101372270,198893718,161867071,119563531,146492625,199138142,127927510,169495203,108350469,111147821,179119682,158639356,175151982,102695954,193887662,193974742,155383370,109839256,164498300,116771960,134040732,145974321,135735563,199268454,157773000,145270903,167996964,120036656,190748298,144279763,189766161,152098947,167226450,145524709,146822476,114827150,109122310,175602782,121660190,176451293,123898763,132095916,153408245,126284281,148392196,148754559,136230497,147179327,103990472,143898067,172627662,120429413,102470234,123228211,167930798,101797035,118935815,167895659,172929192,106246681,136746418,119597443,124751689,120518234,180303353,152200132,170228101,173829516,133089342,167355754,119337331,155552833,193278285,134935057,167779076,156819564,114830655,199054860,134777750,185759702,152084642,169934000,109823844,147388619,106536597,159201798,129728937,144758756,112224792,147484407,135832778,181509283,167947881,111176564,189720916,162279595,138028942,105133492,100798055,142520760,123687079,180290249,115977090,147593675,188770316,143439214,160699641,156041452,191556973,179474144,143098678,152279691,161377579,141762667,192839746,100286275,113672435,170125331,131086951,154932148,100510830,110971199,121313599,172443440,127193085,176338137,162973548,135184581,146769446,130447132,120164577,149822286,117866630,116434151,170956723,181907537,192338566,168285137,102829428,103703607,162006849,148615202,171709374,197035370,128653049,170748620,175116786,195946098,140819424,186561294,148781913,193755822,197567531,198302454,165740605,132754912,135148509,147312167,177869321,120861781,195382512,140389077,182321422,147181364,114574900,145346450,126251049,165068370,160143446,124756530,196750245,131198228,176492895,171799036,100242117,197843716,163772065,172935187,185546218,143889787,185034430,166547413,137974247,103103682,139826704,102458725,159208638,155707896,158411518,196411387,184573712,141313452,118830005,168838423,171019907,192692873,193582715,156898747,116586358,175108496,179677451,189700865,141273633,157025336,112215041,142660845,147397646,109049744,136496382,107138155,109786680,117705979,123421173,185625499,197952933,186129454,132905171,116709620,143695388,150781303,146341044,185828371,163129092,156125641,143543631,166380631,174180850,173241974,105307761,158410205,141199454,188337348,185212036,107337116,157405906,177530280,142680148,159052586,198551573,170189972,121496355,161752684,132387609,197704409,149883123,136013506,148610085,173627068,123249609,193052352,124460899,144587452,134433040,108078688,125734040,175526594,197141333,109669433,188907856,114678574,105104471,157464168,132175686,131044465,131811607,171617044,107938272,142969765,136696682,149454361,116863501,198414693,124609518,160174921,145483781,165626415,167355289,127477345,111652265,119993159,191277643,112685506,194680874,135010004,147364032,118182085,190604412,144911445,131501857,139637924,160509729,141564311,181924946,182142784,116600108,100210213,103534877,170750849,151670021,146780054,160924347,190070481,120171199,193308281,164477895,118762136,137993647,112911474,156320912,152275488,170389249,105231069,179965766,119490538,103813304,171684261,126720041,158047721,168051087,141416805,193300100,165171477,162145318,115136947,163850939,173976634,114572399,154933763,188010933,165078381,157889423,116464119,103734777,189701906,185836397,158925559,102660894,181110670,165325766,173597674,138480723,196340524,166471701,100829050,156068163,126507145,107261899,116986240,160219969,101485292,120320684,119147972,188593558,160967443,197576839,154284710,159222804,198156551,189027839,152187869,108853702,139015349
        }));
    }
}
